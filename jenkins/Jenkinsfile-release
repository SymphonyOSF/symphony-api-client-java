@Library(['sym-pipeline']) _

node {
    withCredentials([
            file(credentialsId: 'JAVA_SDK_GPG_KEY', variable: 'ORG_GRADLE_PROJECT_KEY'),
            string(credentialsId: 'JAVA_SDK_GPG_PASSPHRASE', variable: 'ORG_GRADLE_PROJECT_PASSPHRASE')
    ]) {

        withEnv([
                "GIT_BRANCH=$PARAM_BUILD_BRANCH",
                "GIT_ORG=$PARAM_REPO_OWNER",
                "GIT_REPO=symphony-api-client-java"
        ]) {

            stage('Git Checkout') {
                gitCheckout()
            }

            stage('Build project') {
                sh './gradlew'
            }

            stage('Deploy on OSSRH') {
                sh './gradlew -PnexusUsername=symphony-platform-solutions -PnexusPassword=$ORG_GRADLE_PROJECT_PASSPHRASE uploadArchives closeAndReleaseRepository'
            }
        }
    }
}
